(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{10:function(e,t,i){"use strict";i.r(t);i(7);var n=i(0),a=i(2),r=i(4),o=i(6),s=i(5);function l(e,t){for(var i,a="tet"===t?new n.A(12.5,0):new n.a(12.5,12.5,12.5),r=Math.PI,o=2;o<19;++o)for(var s=0;s<20;++s){var l=r*o/20,c=2*r*s/20;(i=new n.l(a,new n.m({color:16777215*Math.random()}))).position.x=200*Math.sin(l)*Math.cos(c),i.position.y=200*Math.sin(l)*Math.sin(c),i.position.z=200*Math.cos(l),e.add(i)}}function c(e){var t=new n.s(16777215,2);e.add(t)}function d(e,t,i,n){var l=1/window.innerWidth,c=1/window.innerHeight,d=new a.a(r.a);d.uniforms.resolution.value.set(l,c);var h=new o.a(e,n),m=new s.a(t,i);return h.addPass(m),h.addPass(d),h}var h=function(e,t,i,a,r,o){this.innerRadius=i,this.resolution=2048,this.anisotropy=4,this.stretchFactor="number"==typeof o?o:4,this.stretchFactor=Math.min(Math.max(this.stretchFactor,4),8),this.cubeCam=new n.e(.01,1024,this.resolution),this.cubeCam.renderTarget.texture.anisotropy=this.anisotropy,this.cubeCam.renderTarget.texture.minFilter=n.k,this.cubeCam.renderTarget.texture.generateMipmaps=!0,this.geometry=new n.c(this.innerRadius,64),this.material=new n.y({side:n.h,uniforms:{radius:{type:"f",value:this.innerRadius},stretchFactor:{type:"f",value:this.stretchFactor},env:{type:"t",value:this.cubeCam.renderTarget.texture}},vertexShader:"\nvarying vec4 pos_frag;\nvarying vec3 v_position;\nattribute vec2 vertex2D;\nvarying vec2 vUv;\n\nvarying vec3 vNormal;\nvarying vec3 vWorldPosition;\n\nvoid main() {\n    vUv = uv;\n    vec4 worldPosition = modelMatrix * vec4(position, 1.0);\n\n    vNormal = normalize(normalMatrix * normal);\n    vWorldPosition = worldPosition.xyz;\n\n    v_position = worldPosition.xyz - modelMatrix[3].xyz;\n    pos_frag = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );\n    gl_Position = pos_frag;\n}",fragmentShader:"\nuniform samplerCube env;\nvarying vec4 pos_frag;\nvarying vec3 v_position;\nvarying vec2 vUv;\n\nvarying vec3 vNormal;\nvarying vec3 vWorldPosition;\nuniform float radius;\nuniform float stretchFactor;\n\nvec3 inverseTransformDirection(in vec3 dir, in mat4 matrix) {\n    // dir can be either a direction vector or a normal vector\n    // upper-left 3x3 of matrix is assumed to be orthogonal\n    return normalize((vec4(dir, 0.0) * matrix).xyz);\n}\n\nvoid main() {\n    vec3 cameraToFrag = normalize(vWorldPosition - cameraPosition);\n    vec3 normal = normalize(vNormal);\n    vec3 worldNormal = inverseTransformDirection(normal, viewMatrix);\n    worldNormal = vec3(1.0, 0.0, 0.0);\n    float refractionRatio = 1.0;\n    vec3 reflectVec = reflect(cameraToFrag, worldNormal);\n\n    // difference to center\n    vec2 dtc = normalize(vUv - vec2(0.5));\n\n    // distance to center normalized to radius\n    float d = distance(vec3(0.0), v_position.xyz) / radius;\n\n    float pp = stretchFactor;\n    float b = pow(d, pp);\n    float c = 0.5 - tan(b * 1.54); // b * pi / 2\n    vec3 proj = vec3(d * dtc, c);\n\n    // distance to middle mapped to half-sphere\n    reflectVec = normalize(proj);\n\n    vec4 envColor = textureCube(env, vec3(-reflectVec.x, reflectVec.y, reflectVec.z), 0.0);\n    gl_FragColor = envColor;\n}",depthTest:!1}),this.material.needsUpdate=!0,this.entry=a,this.mesh=new n.l(this.geometry,this.material),this.mesh.position.set(this.entry.x,this.entry.y,this.entry.z),this.exit=r,this.wrapper=new n.o,this.wrapper.position.set(this.exit.x,this.exit.y,this.exit.z),this.wrapper.rotation.reorder("ZYX"),this.wrapper.add(this.cubeCam)};h.prototype.getScale=function(){return this.mesh.scale.x},h.prototype.setScale=function(e){var t=this.innerRadius*e;this.material.uniforms.radius.value=t,this.mesh.scale.set(e,e,1),this.material.uniformsNeedUpdate=!0},h.prototype.getExit=function(){return this.exit},h.prototype.getEntry=function(){return this.entry},h.prototype.getWrapper=function(){return this.wrapper},h.prototype.getCubeCam=function(){return this.cubeCam},h.prototype.getMesh=function(){return this.mesh};var m=function(e,t,i,n,a){var r=this;if(!(e instanceof HTMLElement))throw Error("[MobileWidgetControls] Expected element to be an HTMLElement.");var o=window.innerWidth,s=window.innerHeight,l=window.devicePixelRatio;document.body.style.overflowX="hidden",document.body.style.overflowY="hidden",this.element=e,this.leftStickMoveCallback=t,this.rightStickMoveCallback=i,this.buttonPressCallback=n,this.controllerType=a||"default",this.currentDPR=l,this.initialDPR=l,this.CANVAS_ID="widget-drawing-canvas",this.TIME_MS_TO_GET_TO_ORIGINAL_POSITION=60,this.leftStick={},this.rightStick={},this.buttons=[],this.fingers=[];var c=document.getElementById(this.CANVAS_ID);c?this.canvas=c:(this.canvas=document.createElement("canvas"),this.canvas.setAttribute("id",this.CANVAS_ID),this.canvas.setAttribute("width","".concat(o)),this.canvas.setAttribute("height","".concat(s)),this.canvas.setAttribute("style","position: absolute; width: 100%; bottom: 0px; z-index: 999;"),this.element.appendChild(this.canvas)),window.addEventListener("resize",(function(){return r.resize()})),window.addEventListener("orientationchange",(function(){return r.resize()}));var d=function(e){return function(t){if("start"===e&&t.preventDefault(),"move"===e&&(t.preventDefault(),t.stopPropagation()),r.fingers=[],"cancel"!==e){for(var i=t.touches,n=0;n<i.length;++n){var a=i[n],o=a.clientX,s=a.clientY;r.fingers.push({x:o,y:s})}for(var l=t.changedTouches,c=0;c<l.length;++c){var d=l[c];"end"===e?r.updateUp(d):"move"===e?r.updateMove(d):"start"===e&&r.updateDown(d)}}else console.error("[MobileWidgetControls] Too many fingers or unsupported action.")}};this.canvas.addEventListener("touchstart",d("start"),!1),this.canvas.addEventListener("touchmove",d("move"),!1),this.canvas.addEventListener("touchend",d("end"),!1),this.canvas.addEventListener("touchcancel",d("cancel"),!1),this._resizeRequest=null,this.init()};m.prototype.getTimeInMilliseconds=function(){return performance.now()},m.prototype.init=function(){var e=window.innerHeight,t=window.innerWidth;this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(e,"px");var i=window.devicePixelRatio;i!==this.currentDPR&&(console.log("[MobileWidgetControls] Zoom triggered: updating DPR."),this.currentDPR=i);var n=i*t,a=i*e;this.canvas.width=n,this.canvas.height=a;var r=this.controllerType;this.initButtons(r,n,a),this.initSticks(r,n,a),this.draw()},m.PlaystationControllerButtons=[{name:"cross",from:"r",x:85,y:75,label:String.fromCharCode(10761),labelSize:30,diameter:30,labelOffset:2,theme:"gradient"},{name:"circle",from:"r",x:40,y:120,labelSize:23,diameter:30,label:String.fromCharCode(9711),labelOffset:2,theme:"gradient"},{name:"square",from:"r",x:130,y:120,labelSize:36,diameter:30,label:String.fromCharCode(9723),labelOffset:2,theme:"gradient"},{name:"triangle",from:"r",x:85,y:165,labelSize:35,diameter:30,label:String.fromCharCode(9651),labelOffset:0,theme:"gradient"},{name:"L1",from:"l",x:110,y:260,labelSize:30,diameter:30,label:"L1",labelOffset:3,theme:"gradient"},{name:"R1",from:"r",x:110,y:260,labelSize:30,diameter:30,label:"R1",labelOffset:3,theme:"gradient"},{name:"L2",from:"l",x:50,y:280,labelSize:30,diameter:30,label:"L2",labelOffset:3,theme:"gradient"},{name:"R2",from:"r",x:50,y:280,labelSize:30,diameter:30,label:"R2",labelOffset:3,theme:"gradient"},{name:"back"},{name:"forward"},{name:"stickLB"},{name:"stickRB"},{name:"dpadUp",from:"l",x:65,y:205,label:String.fromCharCode(8593),labelSize:20,diameter:23,labelOffset:0,theme:"gradient"},{name:"dpadDown",from:"l",x:65,y:135,label:String.fromCharCode(8595),labelSize:20,diameter:23,labelOffset:0,theme:"gradient"},{name:"dpadLeft",from:"l",x:30,y:170,label:String.fromCharCode(8592),labelSize:20,diameter:23,labelOffset:0,theme:"gradient"},{name:"dpadRight",from:"l",x:100,y:170,label:String.fromCharCode(8594),labelSize:20,diameter:23,labelOffset:0,theme:"gradient"},{name:"home"}],m.XBoxControllerButtons=[{name:"A",from:"r",diameter:25,x:80,y:35,label:"A",labelSize:20,labelOffset:2},{name:"B",from:"r",diameter:25,x:45,y:75,label:"B",labelSize:20,labelOffset:2},{name:"X",from:"r",diameter:25,x:115,y:75,label:"X",labelSize:20,labelOffset:2},{name:"Y",from:"r",diameter:25,x:80,y:115,label:"Y",labelSize:20,labelOffset:2},{name:"LB",from:"l",diameter:35,x:135,y:205,label:"LB",labelSize:20,labelOffset:2},{name:"RB",from:"r",diameter:35,x:130,y:180,label:"RB",labelSize:20,labelOffset:2},{name:"LT",from:"l",diameter:35,x:45,y:210,label:"LT",labelSize:20,labelOffset:2},{name:"RT",from:"r",diameter:35,x:45,y:200,label:"RT",labelSize:20,labelOffset:2},{name:"back"},{name:"forward"},{name:"stickLB"},{name:"stickRB"},{name:"dpadUp",from:"l",diameter:15,x:220,y:73,label:String.fromCharCode(8593),labelSize:20,labelOffset:0},{name:"dpadDown",from:"l",diameter:15,x:220,y:27,label:String.fromCharCode(8595),labelSize:20,labelOffset:0},{name:"dpadLeft",from:"l",diameter:15,x:197,y:50,label:String.fromCharCode(8592),labelSize:20,labelOffset:0},{name:"dpadRight",x:243,y:50,from:"l",diameter:15,label:String.fromCharCode(8594),labelSize:20,labelOffset:0},{name:"home"}],m.prototype.initButtons=function(e,t,i){var n;switch(e){case"playstation":n=m.PlaystationControllerButtons;break;case"xbox":n=m.XBoxControllerButtons;break;default:return}var a=this.initialDPR,r=[];for(var o in n)if(n.hasOwnProperty(o)){var s=n[o];if(s.x&&s.y&&s.diameter){s.name||console.error("[MobileWidgetControls] A button must have a name property.");var l={held:!1};l.id=s.name,l.modelOriginX="l"===s.from?a*s.x:t-a*s.x,l.modelOriginY=i-a*s.y,l.BUTTON_DIAMETER=a*s.diameter,l.style=s.theme,l.BUTTON_LABEL=s.label,l.BUTTON_LABEL_SIZE=a*s.labelSize,l.BUTTON_LABEL_OFFSET=a*s.labelOffset,r.push(l)}}this.buttons=r},m.prototype.notifyButtonChanged=function(e,t){this.buttonPressCallback&&this.buttonPressCallback(e.id,t)},m.prototype.updateButtonModelHold=function(e,t,i,n){for(var a=!1,r=0,o=i.length;r<o;++r){var s=i[r];if(!(this.distanceToObjectCenter(e,t,s)>s.BUTTON_DIAMETER)){a=!0,s.held!==n&&(s.held=n,this.notifyButtonChanged(s,n));break}}return a},m.prototype.updateButtonModelMove=function(e,t,i){for(var n=!1,a=0,r=i.length;a<r;++a){var o=i[a];if(o.held)if(!(this.distanceToObjectCenter(e,t,o)<o.BUTTON_DIAMETER)){for(var s=!1,l=this.fingers,c=this.currentDPR,d=0;d<l.length;++d){var h=l[d];if(this.distanceToObjectCenter(c*h.x,c*h.y,o)<o.BUTTON_DIAMETER){s=!0;break}}s||(n=!0,o.held=!1,this.notifyButtonChanged(o,!1))}}return n},m.prototype.drawButton=function(e,t){e.beginPath(),e.globalAlpha=.3;var i=t.modelOriginX,n=t.modelOriginY;if(e.arc(i,n,t.BUTTON_DIAMETER,0,2*Math.PI),"gradient"===t.style){var a=e.createRadialGradient(i,n,2,i,n,t.BUTTON_DIAMETER);a.addColorStop(0,t.held?"silver":"black"),a.addColorStop(.7,t.held?"silver":"black"),a.addColorStop(.9,"silver"),a.addColorStop(1,"silver"),e.fillStyle=a}else e.fillStyle=t.held?"#222222":"black";e.fill(),"gradient"!==t.style&&(e.lineWidth=1,e.strokeStyle="white",e.stroke()),e.closePath(),e.beginPath(),e.font="".concat(t.BUTTON_LABEL_SIZE,"px Arial"),e.fillStyle="white",e.textAlign="center",e.textBaseline="middle",e.globalAlpha=.4,e.fillText(t.BUTTON_LABEL,i,n+(t.BUTTON_LABEL_OFFSET||0)),e.closePath()},m.DefaultSticks=[{name:"left",from:"l",x:100,y:120,head:25,base:70,grab:150,reach:55,label:String.fromCharCode(10021),labelSize:30,labelOffset:2,theme:"gradient"},{name:"right",from:"r",x:100,y:120,head:25,base:70,grab:150,reach:55,label:String.fromCharCode(10021),labelSize:30,labelOffset:2,theme:"gradient"}],m.PlaystationSticks=[{name:"left",from:"l",x:155,y:80,head:25,base:70,grab:150,reach:55,theme:"gradient"},{name:"right",from:"r",x:240,y:100,head:25,base:70,grab:150,reach:55,theme:"gradient"}],m.XBoxSticks=[{name:"left",from:"l",x:90,y:90,head:35,base:80,grab:150,reach:65,theme:"dark"},{name:"right",from:"r",x:240,y:80,head:30,base:70,grab:130,reach:55,theme:"dark"}],m.prototype.initStick=function(e,t,i,n){var a=this.initialDPR;i.x=i.y=i.lastHeldX=i.lastHeldY=i.timeStampReleased=0,i.modelOriginX="l"===n.from?a*n.x:e-a*n.x,i.modelOriginY=t-a*n.y,i.held=!1,i.needsUpdate=!0,i.STICK_HEAD_DIAMETER=a*n.head,i.STICK_BASE_DIAMETER=a*n.base,i.STICK_GRAB_DISTANCE=a*n.grab,i.STICK_REACH_DISTANCE=a*n.reach,i.STICK_LABEL=n.label,i.STICK_LABEL_SIZE=a*n.labelSize,i.STICK_LABEL_OFFSET=a*n.labelOffset,i.style=n.theme},m.prototype.initSticks=function(e,t,i){var n;switch(e){case"playstation":n=m.PlaystationSticks;break;case"xbox":n=m.XBoxSticks;break;default:n=m.DefaultSticks}this.initStick(t,i,this.leftStick,n[0]),this.initStick(t,i,this.rightStick,n[1])},m.prototype.notifyStickMoved=function(e,t,i){var n=e/i.STICK_REACH_DISTANCE,a=t/i.STICK_REACH_DISTANCE;i===this.leftStick?this.leftStickMoveCallback&&this.leftStickMoveCallback(n,a):i===this.rightStick&&this.rightStickMoveCallback&&this.rightStickMoveCallback(n,a)},m.prototype.updateStickModelFromMove=function(e,t,i,n){var a=e-n.modelOriginX,r=t-n.modelOriginY;i>n.STICK_REACH_DISTANCE&&(a*=n.STICK_REACH_DISTANCE/i,r*=n.STICK_REACH_DISTANCE/i),n.x=a,n.y=r,n.lastHeldX=a,n.lastHeldY=r,this.notifyStickMoved(a,r,n)},m.prototype.updateStickModelMove=function(e,t,i){var n=this.distanceToObjectCenter(e,t,i);if(n<i.STICK_GRAB_DISTANCE)i.needsUpdate=!0,i.held&&this.updateStickModelFromMove(e,t,n,i);else if(i.held){for(var a=!1,r=this.fingers,o=this.currentDPR,s=0;s<r.length;++s){var l=r[s];if(this.distanceToObjectCenter(o*l.x,o*l.y,i)<i.STICK_GRAB_DISTANCE){a=!0;break}}a||(i.held=!1,i.needsUpdate=!0,this.updateStickModelFromMove(e,t,n,i),i.timeStampReleased=this.getTimeInMilliseconds())}},m.prototype.updateStickModelHold=function(e,t,i,n){if(this.distanceToObjectCenter(e,t,i)<i.STICK_GRAB_DISTANCE){var a=i.held;i.held=n,a&&!n&&(i.timeStampReleased=this.getTimeInMilliseconds()),i.needsUpdate=!0}},m.prototype.updateMove=function(e){var t=this.currentDPR,i=e.clientX*t,n=e.clientY*t;this.updateButtonModelMove(i,n,this.buttons),this.updateStickModelMove(i,n,this.leftStick),this.updateStickModelMove(i,n,this.rightStick)},m.prototype.getClosestStick=function(e,t){return this.distanceToObjectCenter(e,t,this.leftStick)<=this.distanceToObjectCenter(e,t,this.rightStick)?this.leftStick:this.rightStick},m.prototype.updateDown=function(e){var t=this.currentDPR,i=e.clientX*t,n=e.clientY*t;if(!this.updateButtonModelHold(i,n,this.buttons,!0)){var a=this.getClosestStick(i,n);this.updateStickModelHold(i,n,a,!0),this.updateStickModelMove(i,n,a)}},m.prototype.updateUp=function(e){var t=this.currentDPR,i=t*e.clientX,n=t*e.clientY;this.updateButtonModelHold(i,n,this.buttons,!1),this.updateStickModelHold(i,n,this.leftStick,!1),this.updateStickModelHold(i,n,this.rightStick,!1)},m.prototype.drawStick=function(e,t){var i=t.modelOriginX,n=t.modelOriginY;if(e.beginPath(),e.globalAlpha=.1,e.arc(i,n,t.STICK_BASE_DIAMETER,0,2*Math.PI),"gradient"===t.style){var a=e.createRadialGradient(i,n,2,i,n,t.STICK_BASE_DIAMETER);a.addColorStop(0,"gray"),a.addColorStop(.7,"gray"),a.addColorStop(.9,"silver"),a.addColorStop(1,"white"),e.fillStyle=a}else e.fillStyle="black";e.fill(),"gradient"!==t.style&&(e.lineWidth=1,e.strokeStyle="white",e.stroke()),e.closePath();var r=t.x,o=t.y;if(e.beginPath(),e.globalAlpha=.1,e.arc(i+r,n+o,t.STICK_HEAD_DIAMETER,0,2*Math.PI),"gradient"===t.style){e.globalAlpha=.15;var s=e.createRadialGradient(i+r,n+o,2,i+r,n+o,t.STICK_HEAD_DIAMETER);s.addColorStop(0,"darkgray"),s.addColorStop(.7,"darkgray"),s.addColorStop(.9,"whitesmoke"),s.addColorStop(1,"white"),e.fillStyle=s}else e.fillStyle="black";e.fill(),"gradient"!==t.style&&(e.lineWidth=1,e.strokeStyle="white",e.stroke()),e.closePath(),t.STICK_LABEL&&t.STICK_LABEL_SIZE&&(e.beginPath(),e.font="".concat(t.STICK_LABEL_SIZE,"px Arial"),e.fillStyle="white",e.textAlign="center",e.textBaseline="middle",e.globalAlpha=.1,e.fillText(t.STICK_LABEL,i+r,n+o+(t.STICK_LABEL_OFFSET||0)),e.closePath())},m.prototype.draw=function(){var e=this.canvas,t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),this.drawStick(t,this.leftStick),this.drawStick(t,this.rightStick);for(var i=this.buttons,n=0,a=i.length;n<a;++n)this.drawButton(t,i[n])},m.prototype.interpolateStick=function(e,t){var i=t-e.timeStampReleased,n=this.TIME_MS_TO_GET_TO_ORIGINAL_POSITION,a=this.smootherstep(0,n,i),r=e.modelOriginX,o=e.modelOriginY,s=(r+e.lastHeldX)*(1-a)+r*a-r,l=(o+e.lastHeldY)*(1-a)+o*a-o;e.x===e.y&&e.x===e.y&&(e.needsUpdate=!1),e.x=s,e.y=l,e.needsUpdate&&this.notifyStickMoved(s,l,e)},m.prototype.animate=function(){var e=this.getTimeInMilliseconds(),t=this.leftStick;!t.held&&t.needsUpdate&&this.interpolateStick(t,e);var i=this.rightStick;!i.held&&i.needsUpdate&&this.interpolateStick(i,e),this.draw()},m.prototype.resize=function(){var e=this;this._resizeRequest&&clearTimeout(this._resizeRequest),this._resizeRequest=setTimeout((function(){window.scrollTo(0,document.body.scrollHeight),e.init()}),100)},m.prototype.distanceToObjectCenter=function(e,t,i){return Math.sqrt(Math.pow(e-i.modelOriginX,2)+Math.pow(t-i.modelOriginY,2))},m.prototype.clamp=function(e,t,i){return Math.min(i,Math.max(t,e))},m.prototype.smootherstep=function(e,t,i){var n=this.clamp((i-e)/(t-e),0,1);return n*n*n*(n*(6*n-15)+10)},m.prototype.makeDocumentUnselectable=function(){var e="mobile-widget-controls-style";if(!document.getElementById(e)){var t=document.getElementsByTagName("head")[0],i=document.createElement("style");i.id=e,i.innerText="\n            *.noselect {\n               -webkit-touch-callout: none; /* iOS Safari */\n                 -webkit-user-select: none; /* Safari */\n                  -khtml-user-select: none; /* Konqueror HTML */\n                    -moz-user-select: none; /* Firefox */\n                     -ms-user-select: none; /* Internet Explorer/Edge */\n                         user-select: none; /* Non-prefixed version, currently\n                                               supported by Chrome and Opera */\n            }\n        ",t.appendChild(i)}document.body.className+=" noselect"};var u=function(e,t,i,n){var a=this;this.camera=t,this.controlsType=i,this.cameraMovementSpeed=.5,this.cameraRotationSpeed=1/150,this.leftX=0,this.leftY=0,this.rightX=0,this.rightY=0,this.rx=0,this.ry=0;this.widgetControls=new m(e,(function(e,t){a.leftX=e,a.leftY=t}),(function(e,t){a.rightX=e,a.rightY=t}),(function(e,t){console.log("Button ".concat(e," ").concat(t?"pressed":"released","."))}),n||"default"),this.widgetControls.makeDocumentUnselectable()};u.prototype.animate=function(){console.log("animate");var e=this.cameraRotationSpeed,t=this.rightX*e,i=this.rightY*e;Math.abs(t)>0&&this.camera.rotateZ(-t),Math.abs(t)>0&&this.camera.rotateX(-i),this.widgetControls.animate()},u.prototype.getForwardVectorFromStick=function(){var e=this.cameraMovementSpeed,t=this.leftX*e,i=this.leftY*e,a=this.getForwardVector(t,-i);return new n.D(a.x*e,a.y*e,a.z*e)},u.prototype.getForwardVector=function(e,t){var i=new n.D(e,0,-t);i.normalize();var a=new n.t;return this.camera.cameraObject.getWorldQuaternion(a),i.applyQuaternion(a),i};var p=function(e,t,i,a,r,o){var s=new n.q(e,t,i,a);if((new n.o).add(s),this.TYPE={quaternion:0,spherical:1},this.controlType="quaternion"===r?this.TYPE.quaternion:"spherical"===r?this.TYPE.spherical:r,this.cameraObject=s,this.wrapper=new n.o,this.wrapper.add(this.cameraObject),this.rx=0,this.ry=0,this.isTouch=o,o){var l=document.getElementById("widget");this.touchControls=new u(l,this,"spherical","default")}};p.prototype.animateTouch=function(){this.touchControls&&this.touchControls.animate()},p.prototype.getRecorder=function(){return this.cameraObject},p.prototype.get3DObject=function(){return this.wrapper},p.prototype.getCameraPosition=function(){return this.get3DObject().position},p.prototype.rotateX=function(e){switch(this.controlType){case this.TYPE.quaternion:var t=new n.t;t.set(e,0,0,1).normalize(),this.cameraObject.quaternion.multiply(t);break;case this.TYPE.spherical:this.rx+=e,this.rx>3*Math.PI/2&&(this.rx-=2*Math.PI),this.rx<-3*Math.PI/2&&(this.rx+=2*Math.PI),this.updateQuaternionFromRotation();break;default:console.log("Unsupported rotation controls!")}},p.prototype.rotateZ=function(e){switch(this.controlType){case this.TYPE.quaternion:var t=new n.t;t.set(0,e,0,1).normalize(),this.cameraObject.quaternion.multiply(t);break;case this.TYPE.spherical:this.rx<-Math.PI/2||this.rx>Math.PI/2?this.ry-=e:this.ry+=e,this.updateQuaternionFromRotation();break;default:console.log("Unsupported rotation controls!")}},p.prototype.flipQuaternion=function(e){var t=new n.D(-e.x,-e.y,e.z),i=new n.D(0,0,Math.sign(t.z)),a=new n.t;a.setFromUnitVectors(i,t),a.multiply(a),this.wrapper.quaternion.premultiply(a)},p.prototype.setRotationXZ=function(e,t){this.rx=e,this.rx>3*Math.PI/2&&(this.rx-=2*Math.PI),this.rx<-3*Math.PI/2&&(this.rx+=2*Math.PI),this.ry=t,this.updateQuaternionFromRotation()},p.prototype.updateQuaternionFromRotation=function(){var e=new n.t,t=new n.t;e.setFromAxisAngle(new n.D(1,0,0),this.rx),t.setFromAxisAngle(new n.D(0,1,0),this.ry),t.multiply(e),this.cameraObject.quaternion.copy(t)},p.prototype.setCameraPosition=function(e,t,i){var n=this.get3DObject();n.position.x=e,n.position.y=t,n.position.z=i},p.prototype.getForwardVector=function(e){if(this.isTouch)return this.getForwardVectorMobile();var t=e[0],i=e[1],a=e[2],r=e[3],o=e[4],s=e[5],l=new n.D(0,0,0);t&&l.add(new n.D(0,0,-1)),i&&l.add(new n.D(0,0,1)),a&&l.add(new n.D(1,0,0)),r&&l.add(new n.D(-1,0,0)),o&&l.add(new n.D(0,1,0)),s&&l.add(new n.D(0,-1,0)),l.normalize();var c=new n.t;return this.cameraObject.getWorldQuaternion(c),l.applyQuaternion(c),l},p.prototype.getForwardVectorMobile=function(){if(this.touchControls)return this.touchControls.getForwardVectorFromStick()};var f=function(e,t,i,a,r,o,s){this.innerRadius=i,this.outerRadius=2*a,this.stretchFactor="number"==typeof s?s:8,this.stretchFactor=Math.min(Math.max(this.stretchFactor,2),32);var l=o.getRecorder();this.camera=new n.q(l.fov,l.aspect,l.near,l.far),this.renderTarget=new n.E(e,t,{minFilter:n.j,magFilter:n.n,format:n.v}),this.geometry=new n.w(this.innerRadius,this.outerRadius,30,5),this.material=new n.y({side:n.g,uniforms:{innerRadius:{type:"f",value:this.innerRadius},outerRadius:{type:"f",value:this.outerRadius},stretchFactor:{type:"f",value:this.stretchFactor},texture1:{type:"t",value:this.renderTarget.texture}},vertexShader:"\nvarying vec4 pos_frag;\nvarying vec4 cent_frag;\nvarying vec3 v_position;\nvarying vec3 v_center;\nattribute vec2 vertex2D;\nvarying vec2 vUv;\nvoid main() {\n    vUv = uv;\n    v_position = (modelMatrix * vec4(position, 1.0)).xyz - modelMatrix[3].xyz;\n    v_center = (modelMatrix * vec4(0.0, 0.0, 0.0, 1.0)).xyz - modelMatrix[3].xyz;\n    mat4 pmv = projectionMatrix * modelViewMatrix;\n    pos_frag = pmv * vec4(position, 1.0);\n    cent_frag = pmv * vec4(vec3(0.0), 1.0);\n    gl_Position = pos_frag;\n}",fragmentShader:"\nuniform sampler2D texture1;\nvarying vec4 pos_frag;\nvarying vec4 cent_frag;\nvarying vec3 v_position;\nvarying vec3 v_center;\nvarying vec2 vUv;\nuniform float innerRadius;\nuniform float outerRadius;\nuniform float stretchFactor;\n\nvoid main() {\n    float initialDistance = distance(v_center, v_position.xyz);\n    float d2 = (initialDistance - innerRadius) / (outerRadius - innerRadius);\n    float factor = 1.0 - d2;\n    factor = pow(factor, stretchFactor);\n\n    float pw = pos_frag.w;\n    vec2 pxy = pos_frag.xy + (cent_frag.xy - pos_frag.xy) * factor * 2.0;\n        // * 1.0 to remove reflection\n    vec2 correctedUv = (vec2(pxy / pw) + vec2(1.0)) * 0.5;\n    gl_FragColor = texture2D(texture1, correctedUv);\n}",depthTest:!1}),this.origin=r,this.mesh=new n.l(this.geometry,this.material),this.mesh.position.set(r.x,r.y,r.z)};f.prototype.getScale=function(){return this.mesh.scale.x},f.prototype.setScale=function(e){var t=this.innerRadius*e,i=this.outerRadius*e;this.material.uniforms.innerRadius.value=t,this.material.uniforms.outerRadius.value=i,this.material.uniformsNeedUpdate=!0,this.mesh.scale.set(e,e,1)},f.prototype.getCamera=function(){return this.camera},f.prototype.getOrigin=function(){return this.origin},f.prototype.getMesh=function(){return this.mesh},f.prototype.getRenderTarget=function(){return this.renderTarget};var v,g,y,w,b,S,x,C,T,k,M,D,E=window.innerWidth,_=window.innerHeight,R=E/_,O={mouseDown:!1,forwardDown:!1,leftDown:!1,rightDown:!1,backDown:!1,downDown:!1,upDown:!1,touchLeft:!1,touchRight:!1,touchUp:!1,touchDown:!1},I=[],A="1";!function(){var e="ontouchstart"in window||navigator.msMaxTouchPoints>0;e?document.getElementById("info").style.display="none":document.getElementById("widget").style.display="none";var t=document.getElementById("container");(b=new n.F({antialias:!0})).setPixelRatio(window.devicePixelRatio),b.setSize(E,_),t.appendChild(b.domElement),y=new n.x,w=new n.x,v=new p(90,R,.1,5e3,"quaternion",e),g=v.getRecorder(),v.setCameraPosition(100,40,0),v.setRotationXZ(0,Math.PI/2),y.add(v.get3DObject());var i=1*window.innerWidth,a=1*window.innerHeight;M=new n.D(0,40,0),D=new n.D(0,50,-150),S=new f(i,a,k=20,2*k,M,v,8),y.add(S.getMesh()),x=new h(i,a,k,M,D,4),y.add(x.getMesh()),w.add(x.getWrapper()),C=d(b,y,g,S.getRenderTarget()),T=d(b,w,g,S.getRenderTarget()),c(y),c(w),l(y,"tet"),l(w,"box"),function(e,t,i,n,a){var r=90,o=83,s=81,l=68,c=16,d=32,h=87,m=83,u=65,p=68,f=16,v=32,g=38,y=40,w=37,b=39,S=16,x=32,C=51,T=80,k=186,M=79,D=50,E=52;document.addEventListener("keydown",(function(e){switch(e.keyCode){case r:case h:case g:case C:i.forwardDown=!0;break;case o:case m:case y:case T:i.backDown=!0;break;case s:case u:case w:case k:i.leftDown=!0;break;case l:case p:case b:case M:i.rightDown=!0;break;case c:case f:case S:case D:i.downDown=!0;break;case d:case v:case x:case E:i.upDown=!0}})),document.addEventListener("keyup",(function(e){switch(e.keyCode){case r:case h:case g:case C:i.forwardDown=!1;break;case o:case m:case y:case T:i.backDown=!1;break;case s:case u:case w:case k:i.leftDown=!1;break;case l:case p:case b:case M:i.rightDown=!1;break;case c:case f:case S:case D:i.downDown=!1;break;case d:case v:case x:case E:i.upDown=!1}}));var _=function(){i.forwardDown=!1,i.leftDown=!1,i.rightDown=!1,i.backDown=!1,i.downDown=!1,i.upDown=!1,i.touchLeft=!1,i.touchRight=!1,i.touchUp=!1,i.touchDown=!1};document.addEventListener("focusout",_),document.addEventListener("visibilitychange",_),document.addEventListener("mousemove",(function(e){if(i.mouseDown){var t=e.movementX||e.mozMovementX||e.webkitMovementX||0,a=e.movementY||e.mozMovementY||e.webkitMovementY||0;n.push([.002*-t,.002*-a])}})),document.addEventListener("mousedown",(function(){i.mouseDown=!0})),document.addEventListener("mouseup",(function(){i.mouseDown=!1}));var R=function(){var t=e.getRecorder();t.aspect=window.innerWidth/window.innerHeight,t.updateProjectionMatrix(),a.setSize(window.innerWidth,window.innerHeight)};window.addEventListener("resize",R,!1),window.addEventListener("orientationchange",R,!1);var O=function(e){_();for(var t=e.touches,a=0;a<t.length;++a){var r=t[a],o=r.clientX,s=r.clientY,l=document.elementFromPoint(o,s);if(l)switch(l.id){case"ll":i.touchLeft=!0,n.push([.002,0]);break;case"lr":i.touchRight=!0,n.push([-.002,0]);break;case"lu":i.touchUp=!0,n.push([0,.002]);break;case"ld":i.touchDown=!0,n.push([0,-.002]);break;case"rl":i.leftDown=!0;break;case"rr":i.rightDown=!0;break;case"ru":i.forwardDown=!0;break;case"rd":i.backDown=!0}}};window.addEventListener("touchstart",O),window.addEventListener("touchmove",O),window.addEventListener("touchend",O)}(v,0,O,I,b)}(),function e(){requestAnimationFrame(e),v.animateTouch();for(var t=0;t<I.length;++t){var i=I[t];i[0]&&v.rotateZ(i[0]),i[1]&&v.rotateX(i[1])}I.length=0,function(){var e,t;"1"===A?(e=x.getEntry(),t=x.getExit()):(e=x.getExit(),t=x.getEntry());var i=v.getCameraPosition(),a=v.getForwardVector([O.forwardDown,O.backDown,O.rightDown,O.leftDown,O.upDown,O.downDown],!1),r=i.distanceTo(e);if(a.distanceTo(new n.D(0,0,0))>0&&r<4*k){var o=k/2,s=new n.D;s.copy(i).negate(),s.add(e),s.multiplyScalar(o/Math.pow(r,3));var l=new n.D;l.copy(a).add(s),(new n.D).copy(l).normalize();var c=new n.t;c.setFromUnitVectors(a,l),v.get3DObject().quaternion.premultiply(c),a.copy(l)}var d=new n.D(i.x+a.x,i.y+a.y,i.z+a.z),h=d.distanceTo(e);if(r>=.5*k&&h<.5*k){!function(e){var t,i,a,r,o=v.get3DObject(),s=S.getMesh(),l=x.getMesh(),c=x.getWrapper();"1"===A?(A="2",t=y,a=w,i=x.getEntry(),r=x.getExit()):(A="1",t=w,a=y,i=x.getExit(),r=x.getEntry());t.remove(o),t.remove(s),t.remove(l),a.remove(c),a.add(o),a.add(s),a.add(l),t.add(c),l.position.copy(r),x.getWrapper().position.copy(i),s.position.copy(r);var d=new n.D;d.copy(e).negate().add(i).normalize(),v.flipQuaternion(d),e.set(r.x-(i.x-e.x),r.y-(i.y-e.y),r.z+(i.z-e.z))}(d);var m=e;e=t,t=m}v.setCameraPosition(d.x,d.y,d.z);var u=x.getMesh(),p=S.getMesh(),f=v.getRecorder(),g=new n.t;f.getWorldQuaternion(g),u.setRotationFromQuaternion(g),p.setRotationFromQuaternion(g),u.lookAt(d),p.lookAt(d);var b=new n.D(t.x-(e.x-i.x),t.y-(e.y-i.y),t.z+(e.z-i.z)),C=x.getCubeCam();C.setRotationFromQuaternion(g),C.lookAt(b)}(),function(){var e,t,i,n=x.getMesh(),a=S.getMesh();"1"===A?(e=C,t=y,i=w):(e=T,t=w,i=y);a.visible=!1,n.visible=!1,e.render(),e.render(),x.getCubeCam().update(b,i),a.visible=!0,n.visible=!0,b.render(t,g)}()}()}},[[10,1,2]]]);